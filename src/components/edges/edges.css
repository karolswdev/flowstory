/* ============================================
   FlowStory Edge Styles
   Uses design tokens from design-tokens.css
   ============================================ */

/* ============================================
   Edge Particles
   ============================================ */
.edge-particle {
  transform-origin: center center;
}

.edge-particle-group {
  pointer-events: none;
}

@keyframes particle-pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.2);
    opacity: 0.8;
  }
}

.edge-particle-active {
  animation: particle-pulse 0.6s ease-in-out infinite;
}

/* ============================================
   Base Edge Styles
   ============================================ */
.react-flow__edge-path {
  stroke-width: 2px;
  fill: none;
  transition: stroke var(--transition-fast);
}

.architectural-canvas .react-flow__edge-path {
  stroke-width: 2.5px;
}

.edge-selected .react-flow__edge-path {
  stroke-width: 2.5px;
}

.edge-active .react-flow__edge-path {
  stroke-width: 2.5px;
  filter: drop-shadow(0 0 4px var(--edge-flow));
  animation: edge-pulse 1.5s ease-in-out infinite;
}

@keyframes edge-pulse {
  0%, 100% {
    filter: drop-shadow(0 0 4px var(--edge-flow));
  }
  50% {
    filter: drop-shadow(0 0 8px var(--edge-flow));
  }
}

.edge-trace .react-flow__edge-path {
  stroke-dasharray: 1000;
  stroke-dashoffset: 1000;
  animation: edge-trace 0.8s ease-out forwards;
}

@keyframes edge-trace {
  to {
    stroke-dashoffset: 0;
  }
}

/* ============================================
   Flow Edge - Solid arrow (success/happy path)
   ============================================ */
.flow-edge .react-flow__edge-path {
  stroke: var(--edge-success);
  stroke-dasharray: none;
}

.flow-edge.edge-active .react-flow__edge-path {
  stroke: var(--node-action-text);
}

.flow-edge-label {
  font-family: var(--font-family);
  background: white;
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--node-action-text);
  border: var(--node-border-width) solid var(--edge-success);
  box-shadow: var(--shadow-sm);
}

/* ============================================
   Event Edge - Dashed with lightning
   ============================================ */
.event-edge .react-flow__edge-path {
  stroke: var(--node-event-border);
  stroke-dasharray: 8 4;
}

.event-edge.edge-active .react-flow__edge-path {
  stroke: var(--node-event-text);
}

.event-edge-icon {
  background: white;
  border-radius: var(--radius-full);
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size-md);
  border: var(--node-border-width) solid var(--node-event-border);
  box-shadow: var(--shadow-sm);
}

.event-edge-icon.icon-active {
  border-color: var(--node-event-text);
  background: var(--node-event-bg);
}

.event-edge-label {
  font-family: var(--font-family);
  background: white;
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--node-event-text);
  border: var(--node-border-width) solid var(--node-event-border);
  box-shadow: var(--shadow-sm);
}

/* ============================================
   Error Edge - Red dashed
   ============================================ */
.error-edge .react-flow__edge-path {
  stroke: var(--edge-error);
  stroke-dasharray: 6 3;
}

.error-edge.edge-active .react-flow__edge-path {
  stroke: var(--node-state-error-text);
}

.error-edge-label {
  font-family: var(--font-family);
  background: white;
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--node-state-error-text);
  border: var(--node-border-width) solid var(--edge-error);
  box-shadow: var(--shadow-sm);
}

/* ============================================
   Async Edge - Dotted with clock
   ============================================ */
.async-edge .react-flow__edge-path {
  stroke: var(--edge-async);
  stroke-dasharray: 3 3;
}

.async-edge.edge-active .react-flow__edge-path {
  stroke: var(--node-actor-text);
}

.async-edge-icon {
  background: white;
  border-radius: var(--radius-full);
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size-md);
  border: var(--node-border-width) solid var(--edge-async);
  box-shadow: var(--shadow-sm);
}

.async-edge-icon.icon-active {
  border-color: var(--node-actor-text);
  background: var(--node-actor-bg);
}

.async-edge-label {
  font-family: var(--font-family);
  background: white;
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--node-actor-text);
  border: var(--node-border-width) solid var(--edge-async);
  box-shadow: var(--shadow-sm);
}

/* ============================================
   Common Label & Icon Styles
   ============================================ */
.edge-label {
  font-family: var(--font-family);
  box-shadow: var(--shadow-sm);
  z-index: 10;
}

.edge-label.label-active {
  font-weight: var(--font-weight-semibold);
}

.edge-icon {
  box-shadow: var(--shadow-sm);
  z-index: 10;
}

/* ============================================
   Extended Edge Types (Architectural Stories)
   ============================================ */

/* Command Edge - Blue (synchronous command) */
.command-edge .react-flow__edge-path {
  stroke: var(--edge-flow);
  stroke-dasharray: none;
}

.command-edge.edge-active .react-flow__edge-path {
  stroke: var(--node-system-text);
}

/* Query Edge - Cyan (request/response) */
.query-edge .react-flow__edge-path {
  stroke: var(--node-state-info-border);
  stroke-dasharray: 4 4;
}

.query-edge.edge-active .react-flow__edge-path {
  stroke: var(--node-state-info-text);
}

/* Action Edge - Teal (user action) */
.action-edge .react-flow__edge-path {
  stroke: var(--node-action-border);
  stroke-dasharray: none;
}

.action-edge.edge-active .react-flow__edge-path {
  stroke: var(--node-action-text);
}

/* Integration Edge - Indigo (external integration) */
.integration-edge .react-flow__edge-path {
  stroke: var(--edge-async);
  stroke-dasharray: 6 3;
}

.integration-edge.edge-active .react-flow__edge-path {
  stroke: var(--node-actor-text);
}

/* Compensation Edge - Orange (rollback) */
.compensation-edge .react-flow__edge-path {
  stroke: var(--node-decision-border);
  stroke-dasharray: 8 4;
}

.compensation-edge.edge-active .react-flow__edge-path {
  stroke: var(--node-decision-text);
}

/* ============================================
   Dark Mode Edge Styles
   ============================================ */
[data-theme="dark"] .react-flow__edge-path {
  filter: brightness(1.1);
}

[data-theme="dark"] .flow-edge .react-flow__edge-path {
  stroke: var(--node-action-border);
}

[data-theme="dark"] .event-edge .react-flow__edge-path {
  stroke: var(--node-event-border);
}

[data-theme="dark"] .error-edge .react-flow__edge-path {
  stroke: var(--edge-error);
}

[data-theme="dark"] .async-edge .react-flow__edge-path {
  stroke: var(--edge-async);
}

[data-theme="dark"] .command-edge .react-flow__edge-path {
  stroke: var(--edge-flow);
}

[data-theme="dark"] .query-edge .react-flow__edge-path {
  stroke: var(--node-state-info-border);
}

[data-theme="dark"] .action-edge .react-flow__edge-path {
  stroke: var(--node-action-border);
}

[data-theme="dark"] .integration-edge .react-flow__edge-path {
  stroke: var(--edge-async);
}

[data-theme="dark"] .compensation-edge .react-flow__edge-path {
  stroke: var(--node-decision-border);
}

/* Dark mode labels */
[data-theme="dark"] .flow-edge-label,
[data-theme="dark"] .event-edge-label,
[data-theme="dark"] .error-edge-label,
[data-theme="dark"] .async-edge-label,
[data-theme="dark"] .edge-label {
  background: var(--color-bg-secondary);
  border-color: rgba(255, 255, 255, 0.15);
}

[data-theme="dark"] .flow-edge-label {
  color: var(--node-action-border);
}

[data-theme="dark"] .event-edge-label {
  color: var(--node-event-border);
}

[data-theme="dark"] .error-edge-label {
  color: var(--edge-error);
}

[data-theme="dark"] .async-edge-label {
  color: var(--edge-async);
}

/* Dark mode icons */
[data-theme="dark"] .event-edge-icon,
[data-theme="dark"] .async-edge-icon,
[data-theme="dark"] .edge-icon {
  background: var(--color-bg-secondary);
  border-color: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .event-edge-icon.icon-active {
  background: var(--color-bg-elevated);
}

[data-theme="dark"] .async-edge-icon.icon-active {
  background: var(--color-bg-elevated);
}
