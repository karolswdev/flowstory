id: password-reset
title: Password Reset Flow
description: User resets their forgotten password
version: "1.0"

actors:
  - id: user
    name: User
    type: user
    avatar: "üîê"
    color: "#FF9800"

nodes:
  - id: user-actor
    type: actor
    actorId: user
    label: User
    position: { x: 50, y: 200 }
  - id: click-forgot
    type: action
    actorId: user
    label: Clicks Forgot Password
    position: { x: 200, y: 200 }
  - id: enter-email
    type: action
    actorId: user
    label: Enters Email
    position: { x: 350, y: 200 }
  - id: generate-token
    type: system
    label: Generate Reset Token
    position: { x: 500, y: 150 }
  - id: send-email
    type: system
    label: Send Reset Email
    position: { x: 650, y: 150 }
  - id: email-sent-event
    type: event
    label: ResetEmailSentEvent
    position: { x: 650, y: 280 }
  - id: check-inbox
    type: action
    actorId: user
    label: Checks Email
    position: { x: 800, y: 200 }
  - id: click-link
    type: action
    actorId: user
    label: Clicks Reset Link
    position: { x: 950, y: 200 }
  - id: enter-new-password
    type: action
    actorId: user
    label: Enters New Password
    position: { x: 1100, y: 200 }
  - id: update-password
    type: system
    label: Update Password
    position: { x: 1250, y: 150 }
  - id: password-changed-event
    type: event
    label: PasswordChangedEvent
    position: { x: 1250, y: 280 }
  - id: success
    type: state
    label: Password Reset
    position: { x: 1400, y: 200 }
    data:
      variant: success

edges:
  - { id: e1, source: user-actor, target: click-forgot, type: flow }
  - { id: e2, source: click-forgot, target: enter-email, type: flow }
  - { id: e3, source: enter-email, target: generate-token, type: flow }
  - { id: e4, source: generate-token, target: send-email, type: flow }
  - { id: e5, source: send-email, target: email-sent-event, type: event }
  - { id: e6, source: send-email, target: check-inbox, type: async, label: waits for }
  - { id: e7, source: check-inbox, target: click-link, type: flow }
  - { id: e8, source: click-link, target: enter-new-password, type: flow }
  - { id: e9, source: enter-new-password, target: update-password, type: flow }
  - { id: e10, source: update-password, target: password-changed-event, type: event }
  - { id: e11, source: update-password, target: success, type: flow }

steps:
  - id: step-1
    order: 1
    nodeIds: [user-actor, click-forgot, enter-email]
    edgeIds: [e1, e2]
    narrative: "User forgot their password. They click 'Forgot Password' and enter their email."
    duration: 2500
  - id: step-2
    order: 2
    nodeIds: [enter-email, generate-token, send-email, email-sent-event]
    edgeIds: [e3, e4, e5]
    narrative: "The system generates a secure reset token and sends an email."
    duration: 3000
  - id: step-3
    order: 3
    nodeIds: [send-email, check-inbox, click-link]
    edgeIds: [e6, e7]
    narrative: "User checks their inbox and clicks the reset link."
    duration: 2500
  - id: step-4
    order: 4
    nodeIds: [click-link, enter-new-password, update-password, password-changed-event, success]
    edgeIds: [e8, e9, e10, e11]
    narrative: "They enter a new password. Account updated! Password reset complete."
    duration: 3000
