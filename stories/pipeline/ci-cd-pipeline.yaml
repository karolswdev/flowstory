id: ci-cd-pipeline
title: CI/CD Build & Deploy Pipeline
description: Automated build, test, and deployment workflow
version: "1.0"

camera:
  center: [0, 0]
  zoom: 0.6

actors:
  - id: pipeline
    name: CI/CD Pipeline
    type: system
    color: "#3B82F6"

nodes:
  - id: trigger
    type: event
    label: Push to main
    size: s
    position: { x: 0, y: -504 }
    data: { variant: info }

  - id: build-stage
    type: system
    label: Build Stage
    size: l
    position: { x: 0, y: -404 }

  - id: compile
    type: action
    label: Compile
    size: s
    position: { x: -200, y: -304 }

  - id: lint
    type: action
    label: Lint
    size: s
    position: { x: 0, y: -304 }

  - id: build-image
    type: action
    label: Build Image
    size: s
    position: { x: 200, y: -304 }

  - id: test-stage
    type: system
    label: Test Stage
    size: l
    position: { x: 0, y: -174 }

  - id: unit-tests
    type: action
    label: Unit Tests
    size: s
    position: { x: -200, y: -74 }

  - id: integration-tests
    type: action
    label: Integration Tests
    size: s
    position: { x: 0, y: -74 }

  - id: security-scan
    type: action
    label: Security Scan
    size: s
    position: { x: 200, y: -74 }

  - id: approval-gate
    type: state
    label: Approval Required
    size: m
    position: { x: 0, y: 46 }
    data: { variant: warning }

  - id: deploy-staging
    type: system
    label: Deploy Staging
    size: l
    position: { x: 0, y: 166 }

  - id: deploy-prod-stage
    type: system
    label: Deploy Production
    size: l
    position: { x: 0, y: 296 }

  - id: deploy-us-east
    type: action
    label: US-East
    size: s
    position: { x: -150, y: 396 }

  - id: deploy-us-west
    type: action
    label: US-West
    size: s
    position: { x: 0, y: 396 }

  - id: deploy-eu
    type: action
    label: EU-West
    size: s
    position: { x: 150, y: 396 }

  - id: complete
    type: state
    label: Deployment Complete
    size: m
    position: { x: 0, y: 526 }
    data: { variant: success }

edges:
  # Vertical main flow - use bottomâ†’top anchors
  - { id: e1, source: trigger, target: build-stage, type: flow, sourceAnchor: bottom, targetAnchor: top }
  
  # Build stage fans out to parallel jobs
  - { id: e2, source: build-stage, target: compile, type: flow, sourceAnchor: left, targetAnchor: top }
  - { id: e3, source: build-stage, target: lint, type: flow, sourceAnchor: bottom, targetAnchor: top }
  - { id: e4, source: build-stage, target: build-image, type: flow, sourceAnchor: right, targetAnchor: top }
  # Build jobs converge to test stage
  - { id: e5, source: compile, target: test-stage, type: flow, sourceAnchor: bottom, targetAnchor: left }
  - { id: e6, source: lint, target: test-stage, type: flow, sourceAnchor: bottom, targetAnchor: top }
  - { id: e7, source: build-image, target: test-stage, type: flow, sourceAnchor: bottom, targetAnchor: right }
  
  # Test stage fans out to parallel tests
  - { id: e8, source: test-stage, target: unit-tests, type: flow, sourceAnchor: left, targetAnchor: top }
  - { id: e9, source: test-stage, target: integration-tests, type: flow, sourceAnchor: bottom, targetAnchor: top }
  - { id: e10, source: test-stage, target: security-scan, type: flow, sourceAnchor: right, targetAnchor: top }
  
  # Tests converge to approval gate
  - { id: e11, source: unit-tests, target: approval-gate, type: flow, sourceAnchor: bottom, targetAnchor: left }
  - { id: e12, source: integration-tests, target: approval-gate, type: flow, sourceAnchor: bottom, targetAnchor: top }
  - { id: e13, source: security-scan, target: approval-gate, type: flow, sourceAnchor: bottom, targetAnchor: right }
  
  # Linear deployment flow
  - { id: e14, source: approval-gate, target: deploy-staging, type: flow, sourceAnchor: bottom, targetAnchor: top, label: approved }
  - { id: e15, source: deploy-staging, target: deploy-prod-stage, type: flow, sourceAnchor: bottom, targetAnchor: top }
  
  # Production fans out to regions
  - { id: e16, source: deploy-prod-stage, target: deploy-us-east, type: flow, sourceAnchor: left, targetAnchor: top }
  - { id: e17, source: deploy-prod-stage, target: deploy-us-west, type: flow, sourceAnchor: bottom, targetAnchor: top }
  - { id: e18, source: deploy-prod-stage, target: deploy-eu, type: flow, sourceAnchor: right, targetAnchor: top }
  
  # Regions converge to complete
  - { id: e19, source: deploy-us-east, target: complete, type: flow, sourceAnchor: bottom, targetAnchor: left }
  - { id: e20, source: deploy-us-west, target: complete, type: flow, sourceAnchor: bottom, targetAnchor: top }
  - { id: e21, source: deploy-eu, target: complete, type: flow, sourceAnchor: bottom, targetAnchor: right }

steps:
  - id: step-1
    nodeIds: [trigger]
    edgeIds: []
    narrative: A developer pushes code to the main branch.

  - id: step-2
    nodeIds: [trigger, build-stage]
    edgeIds: [e1]
    narrative: This triggers the CI/CD pipeline's Build Stage.

  - id: step-3
    nodeIds: [trigger, build-stage, compile]
    edgeIds: [e1, e2]
    narrative: First, the code is compiled.

  - id: step-4
    nodeIds: [trigger, build-stage, compile, lint]
    edgeIds: [e1, e2, e3]
    narrative: In parallel, linting checks code quality.

  - id: step-5
    nodeIds: [trigger, build-stage, compile, lint, build-image]
    edgeIds: [e1, e2, e3, e4]
    narrative: And the Docker image is built.

  - id: step-6
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7]
    narrative: Once all build jobs complete, the Test Stage begins.

  - id: step-7
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage, unit-tests]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7, e8]
    narrative: Unit tests verify individual components.

  - id: step-8
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage, unit-tests, integration-tests]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7, e8, e9]
    narrative: Integration tests verify system interactions.

  - id: step-9
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage, unit-tests, integration-tests, security-scan]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7, e8, e9, e10]
    narrative: Security scan checks for vulnerabilities.

  - id: step-10
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage, unit-tests, integration-tests, security-scan, approval-gate]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7, e8, e9, e10, e11, e12, e13]
    narrative: All tests pass. Now waiting for approval.

  - id: step-11
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage, unit-tests, integration-tests, security-scan, approval-gate, deploy-staging]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7, e8, e9, e10, e11, e12, e13, e14]
    narrative: Approved! Deploying to staging environment.

  - id: step-12
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage, unit-tests, integration-tests, security-scan, approval-gate, deploy-staging, deploy-prod-stage]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7, e8, e9, e10, e11, e12, e13, e14, e15]
    narrative: Staging validated. Production deployment begins.

  - id: step-13
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage, unit-tests, integration-tests, security-scan, approval-gate, deploy-staging, deploy-prod-stage, deploy-us-east]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7, e8, e9, e10, e11, e12, e13, e14, e15, e16]
    narrative: Deploying to US-East region.

  - id: step-14
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage, unit-tests, integration-tests, security-scan, approval-gate, deploy-staging, deploy-prod-stage, deploy-us-east, deploy-us-west]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7, e8, e9, e10, e11, e12, e13, e14, e15, e16, e17]
    narrative: Deploying to US-West region.

  - id: step-15
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage, unit-tests, integration-tests, security-scan, approval-gate, deploy-staging, deploy-prod-stage, deploy-us-east, deploy-us-west, deploy-eu]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7, e8, e9, e10, e11, e12, e13, e14, e15, e16, e17, e18]
    narrative: Deploying to EU-West region.

  - id: step-16
    nodeIds: [trigger, build-stage, compile, lint, build-image, test-stage, unit-tests, integration-tests, security-scan, approval-gate, deploy-staging, deploy-prod-stage, deploy-us-east, deploy-us-west, deploy-eu, complete]
    edgeIds: [e1, e2, e3, e4, e5, e6, e7, e8, e9, e10, e11, e12, e13, e14, e15, e16, e17, e18, e19, e20, e21]
    narrative: All regions deployed. Pipeline complete!
